<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lønnsklokke</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background-color: #FAF9F6; }
    .container { width: 60%; margin: auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .box { margin: 10px 0; padding: 15px; border-radius: 8px; font-size: 1.2em; font-weight: bold; }
    #clock { font-size: 1.5em; background: #6495ED; color: white; }
    #liveEarnings { font-size: 2em; background: #50C878; color: white; }
    #effectiveHourlyRate { font-size: 1.5em; background: #6495ED; color: white; }
    #nightBonus, #weekendBonus, #holidayBonus { font-size: 1.2em; }
    .active { background: #50C878; color: black; }
    .inactive { background: #D22B2B; color: black; }
    input { padding: 10px; margin: 5px; font-size: 1.1em; }
    /* Enkel styling for avkrysningsboks og label */
    .checkbox-group { margin: 10px 0; }
  </style>
</head>
<body>
  <h1>Lønnsklokke</h1>
  <div id="clock" class="box"></div>
  <div id="liveEarnings" class="box">Tjent hittil: 0 kr</div>
  <div id="effectiveHourlyRate" class="box">Effektiv timelønn: 0 kr</div>
  
  <div class="container">
    <label for="startDate">Startdato:</label>
    <input type="date" id="startDate">
    
    <label for="startTime">Starttid:</label>
    <input type="time" id="startTime">
    
    <label for="endDate">Sluttdato:</label>
    <input type="date" id="endDate">
    
    <label for="endTime">Sluttid:</label>
    <input type="time" id="endTime">
    
    <label for="hourlyRate">Timelønn:</label>
    <input type="number" id="hourlyRate" value="616">
    
    <div class="checkbox-group">
      <input type="checkbox" id="holidayCheckbox">
      <label for="holidayCheckbox">Beregn helligdagstillegg</label>
    </div>
    
    <div id="nightBonus" class="box inactive">kr 0 - Kveldstillegg</div>
    <div id="weekendBonus" class="box inactive">kr 0 - Helgetillegg</div>
    <div id="holidayBonus" class="box inactive">kr 0 - Helligdagstillegg</div>
    
    <div id="workDuration" class="box">Vakttid: 0 timer</div>
    <div id="totalEarnings" class="box">Total lønn: 0 kr</div>
    <div id="calculationBreakdown" class="box">Regnestykke: </div>
  </div>
  
  <script>
    // Oppdaterer klokkeslettet hvert sekund
    function updateClock() {
      const now = new Date();
      const days = ["Søndag", "Mandag", "Tirsdag", "Onsdag", "Torsdag", "Fredag", "Lørdag"];
      document.getElementById("clock").textContent = `${days[now.getDay()]}, ${now.toLocaleTimeString('no-NO')}`;
      updateLiveEarnings();
    }
    
    // Live-oppdatering av "Tjent hittil" (basert på nåværende tid)
    function updateLiveEarnings() {
      const startDate = document.getElementById("startDate").value;
      const startTime = document.getElementById("startTime").value;
      const endDate = document.getElementById("endDate").value;
      const endTime = document.getElementById("endTime").value;
      const baseRate = parseFloat(document.getElementById("hourlyRate").value);
      if (!startDate || !startTime || !endDate || !endTime) return;
      
      const start = new Date(`${startDate}T${startTime}`);
      const end = new Date(`${endDate}T${endTime}`);
      const now = new Date();
      if (now < start) {
        document.getElementById("liveEarnings").textContent = "Tjent hittil: 0 kr";
        return;
      }
      const current = now > end ? end : now;
      const elapsedHours = (current - start) / (3600 * 1000);
      let baseEarnings = elapsedHours * baseRate;
      
      // Enkel live-beregning for kvelds- og helgetillegg (basert på start-tidspunkt)
      let nightBonus = (start.getHours() >= 20 || start.getHours() < 6) ? (elapsedHours * 151.27) : 0;
      let weekendBonus = ((start.getDay() === 5 && start.getHours() >= 17) || start.getDay() === 6 || start.getDay() === 0 || (start.getDay() === 1 && start.getHours() < 6)) ? (elapsedHours * 151.27) : 0;
      
      // Helligdagstillegg live beregnes kun hvis avkrysningsboksen er huket av
      let holidayBonusPay = 0;
      if (document.getElementById("holidayCheckbox").checked) {
        let bonusStart = new Date(start);
        bonusStart.setHours(6,0,0,0);
        let bonusEnd = new Date(start);
        bonusEnd.setHours(20,0,0,0);
        if (start < bonusEnd && current > bonusStart) {
          let bonusStartTime = new Date(Math.max(start, bonusStart));
          let bonusEndTime = new Date(Math.min(current, bonusEnd));
          let bonusTimer = (bonusEndTime - bonusStartTime) / (3600 * 1000);
          // Ekstra 10 minutter per time gir bonus tid i timer:
          let bonusHours = bonusTimer * (10/60);
          holidayBonusPay = bonusHours * baseRate;
        }
      }
      
      const earnings = baseEarnings + nightBonus + weekendBonus + holidayBonusPay;
      document.getElementById("liveEarnings").textContent = `Tjent hittil: ${earnings.toFixed(2)} kr`;
    }
    
    // Kalkulerer total lønn, bonus og regnestykke
    function calculateWage() {
      const startDate = document.getElementById("startDate").value;
      const startTime = document.getElementById("startTime").value;
      const endDate = document.getElementById("endDate").value;
      const endTime = document.getElementById("endTime").value;
      let baseRate = parseFloat(document.getElementById("hourlyRate").value);
      let holidayActive = document.getElementById("holidayCheckbox").checked;
      
      if (!startDate || !startTime || !endDate || !endTime) return;
      
      const start = new Date(`${startDate}T${startTime}`);
      const end = new Date(`${endDate}T${endTime}`);
      if (end < start) return;
      
      const diffMs = end - start;
      const hoursWorked = diffMs / (3600 * 1000);
      let baseEarnings = hoursWorked * baseRate;
      
      // Kvelds- og helgetillegg (basert på starttid, slik som tidligere)
      let nightBonusTotal = 0;
      let weekendBonusTotal = 0;
      let nightBonusActive = (start.getHours() >= 20 || start.getHours() < 6);
      let weekendBonusActive = (start.getDay() === 5 && start.getHours() >= 17) || start.getDay() === 6 || start.getDay() === 0 || (start.getDay() === 1 && start.getHours() < 6);
      
      if (nightBonusActive) {
        nightBonusTotal = hoursWorked * 151.27;
        document.getElementById("nightBonus").textContent = `kr ${nightBonusTotal.toFixed(2)} - Kveldstillegg`;
        document.getElementById("nightBonus").className = "box active";
      } else {
        document.getElementById("nightBonus").textContent = "kr 0 - Kveldstillegg";
        document.getElementById("nightBonus").className = "box inactive";
      }
      
      if (weekendBonusActive) {
        weekendBonusTotal = hoursWorked * 151.27;
        document.getElementById("weekendBonus").textContent = `kr ${weekendBonusTotal.toFixed(2)} - Helgetillegg`;
        document.getElementById("weekendBonus").className = "box active";
      } else {
        document.getElementById("weekendBonus").textContent = "kr 0 - Helgetillegg";
        document.getElementById("weekendBonus").className = "box inactive";
      }
      
      // Helligdagstillegg beregnes kun hvis avkrysningsboksen er huket av
      let holidayBonusHours = 0;
      let holidayBonusPay = 0;
      if (holidayActive) {
        // Bonusperiode: 06:00 til 20:00 (bruker samme metode som i skjemaet du viste)
        let bonusStart = new Date(start);
        bonusStart.setHours(6,0,0,0);
        let bonusEnd = new Date(start);
        bonusEnd.setHours(20,0,0,0);
        if (start < bonusEnd && end > bonusStart) {
          let bonusStartTime = new Date(Math.max(start, bonusStart));
          let bonusEndTime = new Date(Math.min(end, bonusEnd));
          let bonusTimer = (bonusEndTime - bonusStartTime) / (3600 * 1000);
          holidayBonusHours = bonusTimer * (10/60); // 10 extra minutes per time
          holidayBonusPay = holidayBonusHours * baseRate;
        }
        document.getElementById("holidayBonus").textContent = `kr ${holidayBonusPay.toFixed(2)} - Helligdagstillegg (${holidayBonusHours.toFixed(2)} timer)`;
        document.getElementById("holidayBonus").className = "box active";
      } else {
        document.getElementById("holidayBonus").textContent = "kr 0 - Helligdagstillegg (0 timer)";
        document.getElementById("holidayBonus").className = "box inactive";
      }
      
      // Total effektiv arbeidstid hvis helligdagsbonus er aktiv
      let totalArbeidstid = hoursWorked + (holidayActive ? holidayBonusHours : 0);
      
      // Total lønn: (effektiv arbeidstid * timelønn) + kvelds- og helgetillegg (beregnet separat)
      // Her summerer vi bonusene direkte med basislønnen:
      let totalEarnings = baseEarnings + nightBonusTotal + weekendBonusTotal + holidayBonusPay;
      
      document.getElementById("workDuration").textContent = `Vakttid: ${hoursWorked.toFixed(2)} timer (Basis) + ${holidayActive ? holidayBonusHours.toFixed(2) + " timer (Helligdag)" : "0 timer"}`;
      document.getElementById("totalEarnings").textContent = `Total lønn: ${totalEarnings.toFixed(2)} kr`;
      document.getElementById("calculationBreakdown").innerHTML = 
        "Regnestykke:<br>" +
        `Basis: (${hoursWorked.toFixed(2)} timer * ${baseRate} kr) = ${baseEarnings.toFixed(2)} kr<br>` +
        `Kveldstillegg: (${hoursWorked.toFixed(2)} timer * 151.27 kr) = ${nightBonusTotal.toFixed(2)} kr<br>` +
        `Helgetillegg: (${hoursWorked.toFixed(2)} timer * 151.27 kr) = ${weekendBonusTotal.toFixed(2)} kr<br>` +
        (holidayActive 
          ? `Helligdagstillegg: ((${bonusEndTimeString(start)} - ${bonusStartTimeString(start)}) / 1 time * (10/60)) * ${baseRate} kr = ${holidayBonusPay.toFixed(2)} kr<br>`
          : "") +
        `Sum: ${baseEarnings.toFixed(2)} + ${nightBonusTotal.toFixed(2)} + ${weekendBonusTotal.toFixed(2)} ${holidayActive ? "+ " + holidayBonusPay.toFixed(2) : ""} = ${totalEarnings.toFixed(2)} kr`;
      
      // Oppdaterer også den effektive timelønnen (total lønn delt på effektiv arbeidstid)
      const effectiveHourlyRate = totalArbeidstid > 0 ? (totalEarnings / totalArbeidstid) : 0;
      document.getElementById("effectiveHourlyRate").textContent = `Effektiv timelønn: ${effectiveHourlyRate.toFixed(2)} kr`;
    }
    
    // Hjelpefunksjoner for visning av bonusperiodens start og slutt (kun for regnestykke-visning)
    function bonusStartTimeString(date) {
      let d = new Date(date);
      d.setHours(6,0,0,0);
      return d.toLocaleTimeString('no-NO', { hour: '2-digit', minute: '2-digit' });
    }
    function bonusEndTimeString(date) {
      let d = new Date(date);
      d.setHours(20,0,0,0);
      return d.toLocaleTimeString('no-NO', { hour: '2-digit', minute: '2-digit' });
    }
    
    // Lytter til endringer i alle inputfeltene
    document.querySelectorAll("input").forEach(input => input.addEventListener("change", calculateWage));
    
    // Oppdater klokken hvert sekund
    setInterval(updateClock, 1000);
  </script>
</body>
</html>
